.model small
.stack 100  
.DATA                  
array DB 100 DUP(?)
sum DB 0 
num db 0  
avg Db 0   
selectionPattern db 77H ; use this variable as selection pattern for port b      

.code
mov ax,@data    

; setting command registors

mov dx,0E6h    ;11100110    ;setting device 2
mov al,10110100b               ;port A input      ;mode 1  ;bc port c instructions
out dx,al
mov dx,0F6h    ;11110110     ;setting device 1
mov al,10000000b      ;port A and Port b output
out dx,al       

;maybe i should set port b here?pc
mov Bx, 100
lea si, array
readData:
cmp Bx,100
jz exit                         
dec bx 

mov [si], al
inc si

add sum, al
inc num  
cmp num, 0    ;to avoid divition by 0
jz  readData
mov al, sum
xor ah,ah
mov bl, num
div bl 

mov avg, al  

mov ah, selectionPattern        
mov dx, 0F2H ;    11110010 ; A2A1 01 for port b
mov al, ah
out dx, al
ROR ah,1   
mov selectionPattern, ah

mov al, avg
mov dx, 0F0H   ; port a
out dx, al

Call DELAY
jmp readData

exit:
JMP exitt 

DELAY PROC
MOV CX,1 ;1 second
L1:
LOOP L1
RET
DELAY ENDP  

exitt:
END